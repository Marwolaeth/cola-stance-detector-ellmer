library(microbenchmark)

test_text <- 'ðŸ¤¡ Ð Ð¾ÑÐºÐ¾Ð¼Ð½Ð°Ð´Ð·Ð¾Ñ€ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» ÐŸÐžÐ›ÐÐžÐ• ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð°Ð´ Ñ€ÑƒÐ½ÐµÑ‚Ð¾Ð¼

ÐŸÑ€Ð°Ð²Ð¸Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¸Ð½ÑÐ»Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ, Ð¿Ð¾ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼Ñƒ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð ÐšÐ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ Ñ€ÐµÑˆÐ°ÐµÑ‚, Ñ‡Ñ‚Ð¾ ÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Â«ÑƒÐ³Ñ€Ð¾Ð·Ð¾Ð¹Â» Ð´Ð»Ñ ÑÐµÑ‚Ð¸, Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾ ÑÐ²Ð¾ÐµÐ¼Ñƒ ÑƒÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¸ÑŽ Ð¿ÐµÑ€ÐµÐ½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°Ñ‚ÑŒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹ Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ°, Ñ€ÐµÐ·Ð°Ñ‚ÑŒ Ð²Ð½ÐµÑˆÐ½Ð¸Ðµ ÐºÐ°Ð½Ð°Ð»Ñ‹ ÑÐ²ÑÐ·Ð¸ Ð¸ Ñ„Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð¼Ñ‹ÐºÐ°Ñ‚ÑŒ Ñ€ÑƒÐ½ÐµÑ‚ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ‚Ñ€Ð°Ð½Ñ‹.

ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹ ÑÐ²ÑÐ·Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð¾Ð±ÑÐ·Ð°Ð½Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÑ‚ÑŒ Ñ€Ð°ÑÐ¿Ð¾Ñ€ÑÐ¶ÐµÐ½Ð¸Ñ ÑÐ»ÑƒÐ¶Ð±Ñ‹ ÑƒÐ¶Ðµ 1 Ð¼Ð°Ñ€Ñ‚Ð° 2026 Ð³Ð¾Ð´Ð°.

Ð§ÐµÐ±ÑƒÑ€Ð½ÐµÑ‚: Ð½Ð°Ñ‡Ð°Ð»Ð¾.'

test_llm_stance_sequential <- function() {
    stance(
        text = test_text,
        target = 'Ð Ð¾ÑÐºÐ¾Ð¼Ð½Ð°Ð´Ð·Ð¾Ñ€',
        type = 'object',
        lang = 'ru',
        chat_base = chat_base
    )
}

test_llm_stance_parallel <- function() {
    llm_stance(
        text = test_text,
        target = 'Ð Ð¾ÑÐºÐ¾Ð¼Ð½Ð°Ð´Ð·Ð¾Ñ€',
        type = 'object',
        lang = 'ru',
        chat_base = chat_base,
        rpm = 19
    )
}

bm <- microbenchmark(
    sequential = test_llm_stance_sequential(),
    parallel = test_llm_stance_parallel(),
    times = 5L,
    check = FALSE
)
